&НаКлиенте
Процедура Сформировать(Команда)
	
	ТекстОшибки = "";
	Если НЕ ГенераторШтрихКодаКлиент.УстановитьКомпонентуШтрихКодирования(ТекстОшибки) Тогда 
		Сообщить("Использование компоненты штрихкодирования в тонком и веб-клиенте невозможна..." + Символы.ПС + ТекстОшибки);	
	КонецЕсли;
	
	Если НЕ СформироватьНаСервере() Тогда 
		Сообщить("Использование компоненты штрихкодирования завершилась ошибкой..." + Символы.ПС + ТекстОшибки);	
	КонецЕсли;
		
КонецПроцедуры


&НаСервере
Функция СформироватьНаСервере()
	
	
	ПолеКартинки = "";
	
	
	ТекстОшибки = "";
	ШК = ГенераторШтрихКода.ПолучитьКомпонентуШтрихКодирования(ТекстОшибки);
	
	Если ШК = Неопределено Тогда 
		Возврат Ложь;	
	КонецЕсли;
	
	
	//Если всё ок - формируем
	//(все свойства компоненты - см.в отладчике)
	ШК.Ширина			= 200;
	ШК.Высота			= 100;
	ШК.ТипКода			= 1; //1 - EAN13 (одномерный), 16 - QR-код (двумерный)
	ШК.УголПоворота		= 0;
	ШК.ЗначениеКода		= СтрокаШК;
	ШК.ПрозрачныйФон	= Истина;
	ШК.ОтображатьТекст	= Истина; //для QR-кода отключить
	
	ДвоичныйШК = ШК.ПолучитьШтрихкод(); //штрихкод в двоичных данных
	КартинкаШК = Новый Картинка(ДвоичныйШК, Истина);
	
	ПолеКартинки = ПоместитьВоВременноеХранилище(КартинкаШК, УникальныйИдентификатор);
	
	
	Возврат Истина; 
	
КонецФункции




Функция ПолучитьКомпонентуШтрихКодирования(ТекстОшибки="") Экспорт
	
	//1. Для корректной работы в тонком и веб-клиентах где-то на клиенте нужно вызвать этот блок:
	//Если НЕ ГенераторШтрихКодаКлиент.УстановитьКомпонентуШтрихКодирования(ТекстОшибки) Тогда 
	//	//Предпринять что-то при ошибки установки компоненты на клиенте	
	//КонецЕсли;
	
	
	//2. Подключение компоненты из общего макета
	Местоположение		= "ОбщийМакет.КомпонентаПечатиШтрихкодов";
	Идентификатор		= "Barcode";
	СимволическоеИмя	= Идентификатор + "SymbolicName";
	ПодключаемыйМодуль	= Неопределено;
	
	Если ПодключитьВнешнююКомпоненту(Местоположение, СимволическоеИмя) Тогда
		
		Попытка
			ПодключаемыйМодуль = Новый("AddIn." + СимволическоеИмя + "." + Идентификатор);
			Если ПодключаемыйМодуль = Неопределено Тогда 
				ТекстОшибки = "Неизвестная ошибка подключения внешней компоненты";
				Возврат Неопределено; //ОШИБКА
			КонецЕсли;
		КонецПопытки;
	КонецЕсли;
	
		
	
	
	Возврат ПодключаемыйМодуль;
	
	
КонецФункции//ПолучитьКомпонентуШтрихКодирования



Функция УстановитьКомпонентуШтрихКодирования(ТекстОшибки="") Экспорт
	
	Попытка
		УстановитьВнешнююКомпоненту("ОбщийМакет.КомпонентаПечатиШтрихкодов");
		Возврат Истина;
	Исключение
		ТекстОшибки = "ОШИБКА УСТАНОВКИ ВНЕШНЕЙ КОМПОНЕНТЫ: " + ОписаниеОшибки();
		Возврат Ложь;
	КонецПопытки;
	
КонецФункции//ПолучитьКомпонентуШтрихКодирования
